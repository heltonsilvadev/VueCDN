<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Lista de Tarefas</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /*
         * ===============================================
         * ESTILOS GERAIS E VARIÁVEIS DE TEMA (CSS)
         * ===============================================
         * Usamos variáveis CSS (:root) para facilitar a troca de temas (claro/escuro).
         * A classe .dark-mode no body sobrescreve essas variáveis para o tema escuro.
        */

        :root {
            /* Tema Claro (Padrão) */
            --bg-color: #f4f4f4;
            --container-bg-color: #fff;
            --text-color: #333;
            --box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --input-border-color: #ddd;
            --add-btn-bg: #007bff;
            --add-btn-hover-bg: #0056b3;
            --list-item-bg: #f9f9f9;
            --list-item-border: #eee;
            --completed-text-color: #888;
            --completed-bg: #e0e0e0;
            --edit-btn-bg: #28a745;
            --edit-btn-hover-bg: #218838;
            --delete-btn-bg: #dc3545;
            --delete-btn-hover-bg: #c82333;
            --theme-toggle-btn-bg: #6c757d;
            --theme-toggle-btn-hover-bg: #5a6268;
            --checkbox-border: #ccc;
            --checkbox-bg: #fff;
            --checkbox-checked-color: #28a745; 
            --save-btn-bg: var(--add-btn-bg);
            --save-btn-hover-bg: var(--add-btn-hover-bg);
        }

        /* Tema Escuro */
        body.dark-mode {
            --bg-color: #2c2c2c;
            --container-bg-color: #3a3a3a;
            --text-color: #e0e0e0;
            --box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            --input-border-color: #555;
            --add-btn-bg: #4a90e2;
            --add-btn-hover-bg: #357ABD;
            --list-item-bg: #4a4a4a;
            --list-item-border: #5a5a5a;
            --completed-text-color: #b0b0b0;
            --completed-bg: #5a5a5a;
            --edit-btn-bg: #34c759;
            --edit-btn-hover-bg: #2ca349;
            --delete-btn-bg: #e74c3c;
            --delete-btn-hover-bg: #c0392b;
            --theme-toggle-btn-bg: #495057;
            --theme-toggle-btn-hover-bg: #343a40;
            --checkbox-border: #777;
            --checkbox-bg: #444;
            --checkbox-checked-color: #34c759;
        }

        /* Estilo base do corpo da página */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Container principal da aplicação */
        .container {
            background-color: var(--container-bg-color);
            padding: 30px;
            border-radius: 8px;
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 500px;
            text-align: center;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        /* Cabeçalho com título e botão de tema */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--text-color);
            margin: 0;
        }

        #theme-toggle-btn {
            padding: 8px 12px;
            background-color: var(--theme-toggle-btn-bg);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #theme-toggle-btn:hover {
            background-color: var(--theme-toggle-btn-hover-bg);
        }

        /* Área de inserção de nova tarefa */
        .input-area {
            display: flex;
            margin-bottom: 30px;
        }

        .input-area form {
            display: flex;
            width: 100%;
        }

        #task-input, .edit-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--input-border-color);
            border-radius: 4px;
            outline: none;
            background-color: var(--container-bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        #task-input::placeholder {
            color: var(--text-color);
            opacity: 0.7;
        }

        #add-task-btn {
            padding: 10px 15px;
            background-color: var(--add-btn-bg);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #add-task-btn:hover {
            background-color: var(--add-btn-hover-bg);
        }

        /* Lista de tarefas */
        #task-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #task-list li {
            background-color: var(--list-item-bg);
            padding: 10px;
            border: 1px solid var(--list-item-border);
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            word-break: break-word; /* Garante que textos longos quebrem a linha */
            color: var(--text-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        
        /* Checkbox customizado para marcar tarefas como concluídas */
        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--checkbox-border);
            background-color: var(--checkbox-bg);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0; /* Impede que o checkbox encolha */
        }

        .task-checkbox::before {
            content: '';
            display: none;
            width: 10px;
            height: 10px;
            background-color: var(--checkbox-checked-color);
            /* Um "check" desenhado com CSS */
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }

        .task-checkbox.checked::before {
            display: block;
        }
        
        /* Texto da tarefa */
        #task-list li .task-text {
            flex-grow: 1;
            text-align: left;
            cursor: pointer;
        }
        
        /* Ações da tarefa (botões de editar/salvar/excluir) */
        #task-list .task-actions {
            display: flex;
            gap: 5px;
        }
        
        /* Estilos para tarefas concluídas */
        #task-list li.completed .task-text {
            text-decoration: line-through;
            color: var(--completed-text-color);
        }

        #task-list li.completed {
            background-color: var(--completed-bg);
        }

        /* Botões de ação genéricos */
        .delete-btn, .edit-btn, .save-btn {
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn { background-color: var(--delete-btn-bg); }
        .delete-btn:hover { background-color: var(--delete-btn-hover-bg); }

        .edit-btn { background-color: var(--edit-btn-bg); }
        .edit-btn:hover { background-color: var(--edit-btn-hover-bg); }

        .save-btn { background-color: var(--save-btn-bg); }
        .save-btn:hover { background-color: var(--save-btn-hover-bg); }

        .save-btn svg, .edit-btn svg {
            width: 16px;
            height: 16px;
            fill: white;
        }
        
        /* Container e display do relógio */
        .clock-container {
            margin-top: 25px;
            display: flex;
            justify-content: flex-end;
        }

        .clock-display {
            color: var(--text-color);
            font-size: 0.9em;
            opacity: 0.8;
            background-color: var(--list-item-bg);
            padding: 5px 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clock-icon {
            width: 1em;
            height: 1em;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        
        <div class="header">
            <h1>Minha Lista de Tarefas</h1>
            <button id="theme-toggle-btn" @click="toggleTheme">
                {{ themeButtonText }}
            </button>
        </div>

        <div class="input-area">
            <form @submit.prevent="addTask">
                <input type="text" id="task-input" placeholder="Adicionar nova tarefa..." v-model="newTaskText">
                <button id="add-task-btn" type="submit">Adicionar</button>
            </form>
        </div>

        <ul id="task-list" v-if="tasks.length > 0">
            <li v-for="task in tasks" :key="task.id" :class="{ 'completed': task.completed }">
                
                <div
                    class="task-checkbox"
                    :class="{ 'checked': task.completed }"
                    @click="toggleTaskCompleted(task)"
                    role="checkbox"
                    :aria-checked="task.completed"
                    tabindex="0"
                    @keydown.space.prevent="toggleTaskCompleted(task)"
                ></div>

                <input 
                    v-if="task.editing" 
                    type="text" 
                    class="edit-input"
                    v-model="task.text"
                    @keyup.enter="saveEdit(task)"     
                    @keyup.esc="cancelEdit(task)"
                    @blur="saveEdit(task)"
                    :ref="el => { if (el) el.focus() }"
                >
                <span v-else class="task-text" @click="toggleTaskCompleted(task)">{{ task.text }}</span>

                <div class="task-actions">
                    <button v-if="task.editing" class="save-btn" @click="saveEdit(task)" aria-label="Salvar edição da tarefa">
                        <svg viewBox="0 0 24 24"><path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"></path></svg>
                    </button>
                    <button v-else class="edit-btn" @click="editTask(task)" aria-label="Editar tarefa">
                        <svg viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6.02 20.71,5.63L18.37,3.29C17.98,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"></path></svg>
                    </button>
                    <button class="delete-btn" @click="deleteTask(task.id)" aria-label="Excluir tarefa">X</button>
                </div>
            </li>
        </ul>

        <div class="clock-container">
            <div class="clock-display">
                <svg class="clock-icon" viewBox="0 0 24 24"><path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"></path></svg>
                <span>{{ currentTime }}</span>
            </div>
        </div>
    </div>

    <!--Vue com CDN-->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        /**
         * ===============================================
         * LÓGICA DA APLICAÇÃO (VUE.JS)
         * ===============================================
         * Esta seção contém toda a lógica da nossa lista de tarefas.
         * O objeto createApp é o ponto de partida da nossa aplicação Vue.
        */
        const { createApp } = Vue;

        createApp({
            // 'data' retorna o estado inicial da nossa aplicação.
            // São as variáveis que o Vue irá monitorar para reatividade.
            data() {
                return {
                    // Array que armazena todos os objetos de tarefa.
                    tasks: [],
                    // String para o campo de input de nova tarefa, ligada com v-model.
                    newTaskText: '',
                    // Booleano para controlar o estado do tema (claro/escuro).
                    isDarkMode: false,
                    // String para exibir a hora atual.
                    currentTime: '',
                    // Referência para o intervalo do relógio, para que possamos limpá-lo depois.
                    clockInterval: null
                };
            },
            
            // 'computed' são propriedades que são calculadas com base em outras propriedades.
            // Elas são eficientes pois só recalculam quando suas dependências mudam.
            computed: {
                // Calcula o texto do botão de tema com base no estado 'isDarkMode'.
                themeButtonText() {
                    return this.isDarkMode ? 'Modo Claro' : 'Dark Mode';
                }
            },
            
            // 'watch' observa mudanças em propriedades de 'data' e executa código em resposta.
            watch: {
                // Sempre que 'isDarkMode' mudar, esta função será executada.
                isDarkMode(newVal) {
                    // Adiciona ou remove a classe 'dark-mode' do body para aplicar o CSS do tema.
                    if (newVal) {
                        document.body.classList.add('dark-mode');
                    } else {
                        document.body.classList.remove('dark-mode');
                    }
                }
            },

            // 'methods' contém as funções que definem o comportamento da aplicação.
            methods: {
                /**
                 * Adiciona uma nova tarefa à lista.
                 */
                addTask() {
                    const text = this.newTaskText.trim(); // Remove espaços em branco do início e fim.
                    if (text === '') return; // Impede a criação de tarefas vazias.
                    
                    // Cria um novo objeto de tarefa com uma estrutura padrão.
                    const newTask = {
                        id: Date.now(), // Usa o timestamp como ID único. Cuidado: pode haver colisões em apps muito rápidos.
                        text: text,
                        completed: false,
                        editing: false // Estado de edição, inicia como falso.
                    };
                    
                    this.tasks.unshift(newTask); // Adiciona a nova tarefa no início do array para aparecer no topo da lista.
                    this.newTaskText = ''; // Limpa o campo de input.
                    this.saveTasks(); // Salva a lista atualizada no localStorage.
                },

                /**
                 * Exclui uma tarefa com base no seu ID.
                 * @param {number} taskId - O ID da tarefa a ser excluída.
                 */
                deleteTask(taskId) {
                    // Cria um novo array contendo todas as tarefas, exceto aquela com o ID correspondente.
                    this.tasks = this.tasks.filter(task => task.id !== taskId);
                    this.saveTasks(); // Salva a lista no localStorage.
                },
                
                /**
                 * Alterna o estado 'completed' de uma tarefa (concluída/não concluída).
                 * @param {object} task - O objeto da tarefa a ser modificada.
                 */
                toggleTaskCompleted(task) {
                    if (task.editing) return; // Não permite marcar como concluída durante a edição.
                    task.completed = !task.completed;
                    this.saveTasks();
                },

                /**
                 * Ativa o modo de edição para uma tarefa específica.
                 * @param {object} task - O objeto da tarefa a ser editada.
                 */
                editTask(task) {
                    // Garante que apenas uma tarefa possa ser editada por vez.
                    this.tasks.forEach(t => t.editing = false);
                    if (task.completed) return; // Não permite editar tarefas já concluídas.
                    
                    task.originalText = task.text; // Salva o texto original para o caso de o usuário cancelar a edição.
                    task.editing = true;
                    // A ref no <input> agora cuida do foco automaticamente.
                },

                /**
                 * Salva as alterações feitas em uma tarefa.
                 * @param {object} task - O objeto da tarefa que foi editada.
                 */
                saveEdit(task) {
                    // Esta verificação garante que a função não faça nada se a tarefa não estiver mais em modo de edição.
                    // Isso é útil por causa do evento @blur, que pode disparar inesperadamente.
                    if (!task.editing) return;
                    
                    // Se o texto for vazio após a edição, restaura o texto original.
                    if (task.text.trim() === '') {
                        task.text = task.originalText;
                    }

                    delete task.originalText; // Remove a propriedade temporária.
                    task.editing = false; // Sai do modo de edição.
                    this.saveTasks(); // Salva no localStorage.
                },
                
                /**
                 * Cancela a edição, restaurando o texto original da tarefa.
                 * @param {object} task - O objeto da tarefa cuja edição será cancelada.
                 */
                cancelEdit(task) {
                    task.text = task.originalText; // Restaura o texto.
                    delete task.originalText; // Remove a propriedade temporária.
                    task.editing = false; // Sai do modo de edição.
                },

                /**
                 * Alterna o tema entre claro e escuro.
                 */
                toggleTheme() {
                    this.isDarkMode = !this.isDarkMode;
                    this.saveTheme(); // Salva a preferência de tema do usuário.
                },
                
                /**
                 * Salva a lista de tarefas no localStorage do navegador.
                 * JSON.stringify converte o array de objetos em uma string.
                 */
                saveTasks() {
                    localStorage.setItem('tasks', JSON.stringify(this.tasks));
                },
                
                /**
                 * Salva a preferência de tema no localStorage.
                 */
                saveTheme() {
                    localStorage.setItem('theme', this.isDarkMode ? 'dark' : 'light');
                },

                /**
                 * Carrega as tarefas e o tema salvos do localStorage quando a página é iniciada.
                 */
                loadState() {
                    // Carrega o tema
                    const savedTheme = localStorage.getItem('theme');
                    this.isDarkMode = savedTheme === 'dark';

                    // Carrega as tarefas
                    const savedTasks = localStorage.getItem('tasks');
                    if (savedTasks) {
                        try {
                            // JSON.parse converte a string de volta para um objeto/array.
                            // O .map garante que nenhuma tarefa comece em modo de edição ao carregar a página.
                            this.tasks = JSON.parse(savedTasks).map(task => ({
                                ...task,
                                editing: false 
                            }));
                        } catch (e) {
                            console.error("Erro ao carregar tarefas do localStorage:", e);
                            this.tasks = []; // Em caso de erro, inicia com uma lista vazia.
                        }
                    }
                },

                /**
                 * Atualiza o relógio a cada segundo.
                 */
                updateClock() {
                    const now = new Date();
                    // padStart garante que números menores que 10 tenham um '0' na frente (ex: 09:05:03).
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds()).padStart(2, '0');
                    this.currentTime = `${hours}:${minutes}:${seconds}`;
                }
            },
            
            // 'mounted' é um "gancho de ciclo de vida" do Vue. O código aqui dentro
            // é executado assim que o componente é montado na página.
            mounted() {
                this.loadState(); // Carrega dados salvos.
                this.updateClock(); // Atualiza o relógio pela primeira vez.
                this.clockInterval = setInterval(this.updateClock, 1000); // Inicia o intervalo do relógio.
            },
            
            // 'beforeUnmount' é executado pouco antes de o componente ser destruído.
            // É o local ideal para limpar recursos e evitar vazamentos de memória.
            beforeUnmount() {
                clearInterval(this.clockInterval); // Limpa o intervalo do relógio.
            }
        }).mount('#app');
    </script>
</body>
</html>